<!DOCTYPE html>
<html>
<head>
  
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>USERS CRUD</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
  <link href="es1.css" rel="stylesheet" type="text/css">

</head>
<body>
    <div class="container">
        <div class="row my-row">
            <div class="col-6 my-col">
                <form action="javascript:void(0);" method="POST" onsubmit="app.Add()"> 
                    <div class="input-group input-group-sm mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" >New User</span>
                        </div>
                    <input type="text" id="add-name" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-sm">
                    <input class="btn btn-outline-primary btn-sm" type="submit" value="Add">
                    </div>                  
                </form>
            </div>

            <div class="col-6 my-col" id="spoiler" role="aria-hidden">
                <form action="javascript:void(0);" method="POST" id="saveEdit">
                    <div class="input-group input-group-sm mb-3">
                        <input type="text" id="edit-name" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-sm">
                        <input class="btn btn-outline-secondary btn-sm" type="submit" value="Edit" /> 
                        <a class="close" onclick="CloseInput()" aria-label="Close">&#10006;</a>
                    </div>
                </form>
            </div>
        </div>
    
        <div class="row justify-content-center my-row">
           <p id="counter"></p>
        </div>
        
        <div class="row justify-content-center my-row">
            <table>
                  <tr class="row my-row">
                    <th class="col-4 my-col">Name</th>
                  </tr>
                  <tbody id="users">
                  </tbody>
            </table>
        </div>
    </div>

    <script>
        var app = new function() {

          this.el = document.getElementById('users');

          this.users = ['Anna', 'Bett', 'Carlo', 'Dani', 'Eli', 'Fabri'];

          this.Count = function(data) {
            var el   = document.getElementById('counter');
            var name = 'user';

            if (data) {
              if (data > 1) {
                name = 'users';
              }
              el.innerHTML = data + ' ' + name ;
            } else {
              el.innerHTML = 'No ' + name;
            }
          };
  
          this.FetchAll = function() {
            var data = '';

            if (this.users.length > 0) {
              for (i = 0; i < this.users.length; i++) {
                data += '<tr class="row my-row">';
                data += '<td class="col-4 my-col">' + this.users[i] + '</td>';
                data += '<td class="col-4 my-col"><button class="btn btn-outline-secondary btn-sm" onclick="app.Edit(' + i + ')">Edit</button></td>';
                data += '<td class="col-4 my-col"><button class="btn btn-outline-danger btn-sm" onclick="app.Delete(' + i + ')">Delete</button></td>';
                data += '</tr>';
              }
            }

            this.Count(this.users.length);
            return this.el.innerHTML = data;
          };

          this.Add = function () {
            el = document.getElementById('add-name');
            // Get the value
            var user = el.value;

            if (user) {
              // Add the new value
              this.users.push(user.trim());
              // Reset input value
              el.value = '';
              // Dislay the new list
              this.FetchAll();
            }
          };

          this.Edit = function (item) {
            var el = document.getElementById('edit-name');
            // Display value in the field
            el.value = this.users[item];
            // Display fields
            document.getElementById('spoiler').style.display = 'block';
            self = this;

            document.getElementById('saveEdit').onsubmit = function() {
              // Get value
              var user = el.value;

              if (user) {
                // Edit value
                self.users.splice(item, 1, user.trim());
                // Display the new list
                self.FetchAll();
                // Hide fields
                CloseInput();
              }
            }
          };

          this.Delete = function (item) {
            // Delete the current row
            this.users.splice(item, 1);
            // Display the new list
            this.FetchAll();
          };
  
        }

        app.FetchAll();

        function CloseInput() {
          document.getElementById('spoiler').style.display = 'none';
        }
    </script>

</body>
</html>